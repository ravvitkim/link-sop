# ğŸ“Š RAG ë¡œì§ ì²˜ë¦¬ê³¼ì • ë° ë©”íƒ€ë°ì´í„° ë¶„ì„ v9.1

## ğŸ”„ ì „ì²´ ì²˜ë¦¬ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Upload     â”‚â”€â”€â”€â”€â–¶â”‚   Convert    â”‚â”€â”€â”€â”€â–¶â”‚    Split     â”‚â”€â”€â”€â”€â–¶â”‚   Embed      â”‚
â”‚  (íŒŒì¼ ìˆ˜ì‹ )  â”‚     â”‚ (ë§ˆí¬ë‹¤ìš´ë³€í™˜) â”‚     â”‚  (ì²­í¬ ë¶„í• )  â”‚     â”‚ (ë²¡í„° ì €ì¥)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                      â”‚
                                                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Response   â”‚â—€â”€â”€â”€â”€â”‚     LLM      â”‚â—€â”€â”€â”€â”€â”‚   Context    â”‚â—€â”€â”€â”€â”€â”‚   Search     â”‚
â”‚  (ì‘ë‹µ ë°˜í™˜)  â”‚     â”‚  (ë‹µë³€ ìƒì„±)  â”‚     â”‚ (í”„ë¡¬í”„íŠ¸êµ¬ì„±) â”‚     â”‚ (ë²¡í„° ê²€ìƒ‰)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ íŒŒì¼ êµ¬ì¡° ë° ì—­í• 

```
rag/
â”œâ”€â”€ document_pipeline.py    # ğŸ”¥ v9.1 ë©”ì¸ íŒŒì´í”„ë¼ì¸ (LangGraph)
â”œâ”€â”€ document_processor.py   # v8.0 ì„ í˜• íŒŒì´í”„ë¼ì¸ (í´ë°±)
â”œâ”€â”€ document_loader.py      # v7.0 ë ˆê±°ì‹œ (Neo4j ê·¸ë˜í”„ìš©)
â”œâ”€â”€ chunker.py              # ë ˆê±°ì‹œ ì²­í‚¹ (document_loaderì™€ í•¨ê»˜ ì‚¬ìš©)
â”œâ”€â”€ vector_store.py         # ChromaDB ë²¡í„° ì €ì¥ì†Œ
â”œâ”€â”€ graph_store.py          # Neo4j ê·¸ë˜í”„ ì €ì¥ì†Œ
â”œâ”€â”€ prompt.py               # RAG í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
â”œâ”€â”€ llm.py                  # LLM ì—°ë™ (Ollama/HuggingFace)
â””â”€â”€ __init__.py             # íŒ¨í‚¤ì§€ ì´ˆê¸°í™”
```

### íŒŒì´í”„ë¼ì¸ ì„ íƒ

| ì¡°ê±´ | ì‚¬ìš© íŒŒì´í”„ë¼ì¸ |
|------|----------------|
| `use_langgraph=True` (ê¸°ë³¸) | `document_pipeline.py` (v9.1) |
| `use_langgraph=False` | `document_processor.py` (v8.0) |
| Neo4j ê·¸ë˜í”„ ì—…ë¡œë“œ | `document_loader.py` + `chunker.py` |

---

## ğŸ“¥ 1ë‹¨ê³„: ë¬¸ì„œ ì—…ë¡œë“œ â†’ LangGraph íŒŒì´í”„ë¼ì¸

### v9.1 LangGraph ë…¸ë“œ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Load   â”‚â”€â”€â”€â–¶â”‚ Convert â”‚â”€â”€â”€â–¶â”‚ Validate â”‚â”€â”€â”€â–¶â”‚  Split  â”‚â”€â”€â”€â–¶â”‚ Optimize â”‚â”€â”€â”€â–¶â”‚ Finalize â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚              â”‚
                    â–¼              â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Fallback â”‚  â”‚  Repair  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê° ë…¸ë“œë³„ ì²˜ë¦¬

| ë…¸ë“œ | ì…ë ¥ | ì²˜ë¦¬ | ì¶œë ¥ |
|------|------|------|------|
| **Load** | filename, content | ì‹¤ì œ í™•ì¥ìë¡œ íŒŒì¼ íƒ€ì… ê°ì§€ | file_type |
| **Convert** | content, file_type | DOCX/PDF/HTML â†’ ë§ˆí¬ë‹¤ìš´ + í˜ì´ì§€ ë§ˆì»¤ | markdown |
| **Fallback** | content | pdfplumber â†’ Docling â†’ PyMuPDF â†’ PyPDF2 | markdown |
| **Validate** | markdown | í’ˆì§ˆ ì ìˆ˜ ê³„ì‚° (0~100%) | quality_score |
| **Repair** | markdown | í—¤ë” ì¶”ë¡ , í…Œì´ë¸” ë³µêµ¬, íŠ¹ìˆ˜ë¬¸ì ì œê±° | markdown |
| **Split** | markdown | í—¤ë”(`#`) ê¸°ì¤€ ì„¹ì…˜ ë¶„í•  + í˜ì´ì§€/Parent ì¶”ì  | sections[] |
| **Optimize** | sections | ê¸´ ì„¹ì…˜ ì¬ë¶„í•  + ìµœì í™”ëœ ë©”íƒ€ë°ì´í„° | chunks[] |
| **Finalize** | chunks | í†µê³„ ì •ë¦¬ | success, metadata |

### ì¡°ê±´ë¶€ ë¼ìš°íŒ…

```python
# ë³€í™˜ ì‹¤íŒ¨ â†’ í´ë°±
def should_fallback(state):
    if state.get("errors") or not state.get("markdown"):
        return "fallback"
    return "validate"

# í’ˆì§ˆ ë‚®ìŒ â†’ ë³´ì •
def should_repair(state):
    if state.get("quality_score") < 0.5 and state.get("retry_count") < 2:
        return "repair"
    return "split"
```

---

## ğŸ“¦ 2ë‹¨ê³„: ë©”íƒ€ë°ì´í„° êµ¬ì¡°

### v9.1 ì²­í¬ ë©”íƒ€ë°ì´í„° (ìµœì í™”ë¨)

```python
{
    # ğŸ”¥ í•„ìˆ˜ (ê²€ìƒ‰/í•„í„°ë§)
    "doc_name": "EQ-SOP-00010_í’ˆì§ˆê´€ë¦¬ê¸°ì¤€ì„œ.pdf",   # íŒŒì¼ëª…
    "sop_id": "EQ-SOP-00010",                        # SOP ë²ˆí˜¸
    "section_path": "5 ì ˆì°¨ Procedure > 5.1 í’ˆì§ˆê´€ë¦¬ê¸°ì¤€ì„œì˜ êµ¬ì„±",  # ê³„ì¸µ ê²½ë¡œ
    "section": "5.1 í’ˆì§ˆê´€ë¦¬ê¸°ì¤€ì„œì˜ êµ¬ì„± ë° ê´€ë¦¬",  # í˜„ì¬ ì„¹ì…˜ëª…
    
    # ğŸ”¥ ìœ ìš© (ì¶œì²˜/ë¶„ì„)
    "article_num": "5.1",                # ì¡°í•­ ë²ˆí˜¸
    "page": 4,                           # ğŸ†• PDF í˜ì´ì§€ ë²ˆí˜¸
    "parent": "5 ì ˆì°¨ Procedure",        # ğŸ†• ìƒìœ„ ì„¹ì…˜ (Parent-Child)
    
    # ë¶„í•  ì²­í¬ ì¶”ì 
    "chunk_part": 1,                     # ë¶„í• ëœ ì²­í¬ ë²ˆí˜¸
    "total_parts": 3,                    # ì´ ë¶„í•  ìˆ˜
    
    # ë¬¸ì„œ ë²„ì „ ì •ë³´
    "version": "1.0",                    # ğŸ†• ë¬¸ì„œ ë²„ì „
    "effective_date": "2025-01-21",      # ğŸ†• ì‹œí–‰ì¼
}
```

### ë¬¸ì„œ ë ˆë²¨ ë©”íƒ€ë°ì´í„°

```python
{
    "file_name": "EQ-SOP-00010_í’ˆì§ˆê´€ë¦¬ê¸°ì¤€ì„œ.pdf",
    "file_type": "pdf",
    "file_size": 123456,
    "sop_id": "EQ-SOP-00010",
    "version": "1.0",
    "effective_date": "2025-01-21",
    "title": "í’ˆì§ˆê´€ë¦¬ê¸°ì¤€ì„œ",
    "department": "í’ˆì§ˆê²½ì˜ì‹¤",
    "total_pages": 11,
    "total_chunks": 70,
    "quality_score": 0.8,
    "conversion_method": "pdfplumber+infer-headers",
}
```

### ë©”íƒ€ë°ì´í„° ì‚¬ìš©ì²˜

| í•„ë“œ | ì‚¬ìš©ì²˜ | í•„ìˆ˜? |
|------|--------|-------|
| `doc_name` | ë¬¸ì„œ í•„í„°ë§, ì‚­ì œ, ëª©ë¡ | âœ… í•„ìˆ˜ |
| `sop_id` | ë¬¸ì„œ ì‹ë³„, í”„ë¡¬í”„íŠ¸ ì¶œì²˜ | âœ… í•„ìˆ˜ |
| `section_path` | ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ, í”„ë¡¬í”„íŠ¸ ì»¨í…ìŠ¤íŠ¸ | âœ… í•„ìˆ˜ |
| `section` | UI í‘œì‹œ, í˜„ì¬ ì„¹ì…˜ | âœ… í•„ìˆ˜ |
| `article_num` | ì¡°í•­ ë²ˆí˜¸ í‘œì‹œ, ì •ë ¬ | âš¡ ìœ ìš© |
| `page` | PDF í˜ì´ì§€ ì°¸ì¡° | âš¡ ìœ ìš© |
| `parent` | ê³„ì¸µ íƒìƒ‰, ê´€ë ¨ ì„¹ì…˜ ì°¾ê¸° | âš¡ ìœ ìš© |
| `chunk_part/total_parts` | ê¸´ ì„¹ì…˜ ì¶”ì  | ğŸ”§ ì„ íƒì  |
| `version/effective_date` | ë¬¸ì„œ ë²„ì „ ê´€ë¦¬ | ğŸ”§ ì„ íƒì  |

### v9.0 vs v9.1 ë¹„êµ

| í•­ëª© | v9.0 | v9.1 |
|------|------|------|
| í•„ë“œ ìˆ˜ | 14ê°œ | 11ê°œ |
| í˜ì´ì§€ ë²ˆí˜¸ | âŒ | âœ… `page` |
| Parent ê³„ì¸µ | âŒ | âœ… `parent` |
| ë¬¸ì„œ ë²„ì „ | âŒ | âœ… `version`, `effective_date` |
| ì¤‘ë³µ í•„ë“œ | `section_path_readable`, `doc_title`, `H1~H4` | ì œê±°ë¨ |

---

## ğŸ” 3ë‹¨ê³„: ê²€ìƒ‰ (vector_store.py)

### ê²€ìƒ‰ ìš”ì²­

```python
results = search(
    query="í’ˆì§ˆê´€ë¦¬ì±…ì„ìì˜ ì—­í• ì€?",
    collection_name="documents",
    n_results=5,
    filter_doc="EQ-SOP-00010_í’ˆì§ˆê´€ë¦¬ê¸°ì¤€ì„œ.pdf",  # doc_name í•„í„°
    similarity_threshold=0.35
)
```

### ë°˜í™˜ í˜•ì‹

```python
[
    {
        "text": "í’ˆì§ˆê´€ë¦¬ì±…ì„ì(QC Manager)ëŠ” ë³¸ ê¸°ì¤€ì„œì˜ ì œÂ·ê°œì •...",
        "similarity": 0.87,
        "metadata": {
            "doc_name": "EQ-SOP-00010_í’ˆì§ˆê´€ë¦¬ê¸°ì¤€ì„œ.pdf",
            "sop_id": "EQ-SOP-00010",
            "section_path": "4 ì±…ì„ Responsibilities > 4.1",
            "section": "4.1 í’ˆì§ˆê´€ë¦¬ì±…ì„ì(QC Manager)ëŠ”...",
            "article_num": "4.1",
            "page": 3,
            "parent": "4 ì±…ì„ Responsibilities",
        },
        "confidence": "high"  # high/medium/low
    },
    ...
]
```

### ë©”íƒ€ë°ì´í„° í™œìš©

1. **filter_doc**: `doc_name` í•„ë“œë¡œ íŠ¹ì • ë¬¸ì„œë§Œ ê²€ìƒ‰
2. **ì¶œì²˜ í‘œì‹œ**: `sop_id`, `section_path`ë¡œ ë‹µë³€ì— ì¶œì²˜ í‘œì‹œ
3. **í˜ì´ì§€ ì°¸ì¡°**: `page`ë¡œ ì›ë³¸ ë¬¸ì„œ ìœ„ì¹˜ ì•ˆë‚´
4. **ê³„ì¸µ íƒìƒ‰**: `parent`ë¡œ ìƒìœ„ ì„¹ì…˜ ì»¨í…ìŠ¤íŠ¸ ì œê³µ
5. **ë˜ë¬»ê¸° íŒë‹¨**: ì—¬ëŸ¬ `doc_name`ì—ì„œ ê²°ê³¼ â†’ ë¬¸ì„œ ì„ íƒ ìš”ì²­

---

## ğŸ’¬ 4ë‹¨ê³„: LLM í”„ë¡¬í”„íŠ¸ (prompt.py)

### ì»¨í…ìŠ¤íŠ¸ í¬ë§·íŒ…

```python
def format_context_with_metadata(search_results):
    """
    ğŸ“„ [EQ-SOP-00010] > 4 ì±…ì„ > 4.1 (p.3, ê´€ë ¨ë„: 87%)
    í’ˆì§ˆê´€ë¦¬ì±…ì„ì(QC Manager)ëŠ” ë³¸ ê¸°ì¤€ì„œì˜ ì œÂ·ê°œì •...
    
    ---
    
    ğŸ“„ [EQ-SOP-00010] > 5 ì ˆì°¨ > 5.1 (p.4, ê´€ë ¨ë„: 82%)
    í’ˆì§ˆê´€ë¦¬ê¸°ì¤€ì„œëŠ” í’ˆì§ˆê´€ë¦¬(QC) í™œë™ì˜ ê¸°ë³¸ ì›ì¹™ê³¼...
    """
```

### RAG í”„ë¡¬í”„íŠ¸ ì˜ˆì‹œ

```python
def build_rag_prompt(query, context, language="ko"):
    return f"""ë‹¹ì‹ ì€ GMP/QMS ê·œì •(SOP) ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

ğŸ“‹ ì¤‘ìš” ì§€ì¹¨:
- ê° ì°¸ê³  ë¬¸ì„œì—ëŠ” [ë¬¸ì„œë²ˆí˜¸] > ì„¹ì…˜ê²½ë¡œ (í˜ì´ì§€)ê°€ í‘œì‹œë˜ì–´ ìˆìŠµë‹ˆë‹¤.
- ë‹µë³€ ì‹œ ë°˜ë“œì‹œ í•´ë‹¹ ì¶œì²˜ë¥¼ ì¸ìš©í•˜ì„¸ìš”. ì˜ˆ: "(EQ-SOP-00010, 4.1ì ˆ, p.3)"
- ë¬¸ì„œì— ì—†ëŠ” ë‚´ìš©ì€ ì ˆëŒ€ ë‹µë³€í•˜ì§€ ë§ˆì„¸ìš”.

[ì°¸ê³  ë¬¸ì„œ]
{context}

[ì‚¬ìš©ì ì§ˆë¬¸]
{query}

[ì „ë¬¸ê°€ ë‹µë³€ - ë°˜ë“œì‹œ ì¶œì²˜ ì¸ìš©]:"""
```

---

## ğŸ“Š í’ˆì§ˆ ê²€ì¦ ì‹œìŠ¤í…œ

### 5ê°€ì§€ ê²€ì¦ í•­ëª©

| í•­ëª© | ê¸°ì¤€ | ë°°ì  | ê²€ì¦ ë‚´ìš© |
|------|------|------|----------|
| í…ìŠ¤íŠ¸ ê¸¸ì´ | â‰¥ 100ì | 20% | ë¹ˆ ë¬¸ì„œ ê°ì§€ |
| í—¤ë” ê°œìˆ˜ | â‰¥ 3ê°œ | 30% | êµ¬ì¡°í™” ì •ë„ |
| ë¬¸ë‹¨ êµ¬ì¡° | â‰¥ 5ê°œ | 20% | ë¬¸ë‹¨ ë¶„ë¦¬ |
| í•œê¸€ ë¹„ìœ¨ | â‰¥ 10% | 20% | í•œê¸€ ë¬¸ì„œ í™•ì¸ |
| íŠ¹ìˆ˜ë¬¸ì ì˜¤ì—¼ | < 1% | 10% | ê¹¨ì§„ ë¬¸ì ê°ì§€ |

### í’ˆì§ˆ ì ìˆ˜ í™œìš©

- **â‰¥ 80%**: ì •ìƒ ì²˜ë¦¬
- **50~80%**: ê²½ê³  í‘œì‹œ
- **< 50%**: `Repair` ë…¸ë“œë¡œ ë¼ìš°íŒ… (ìë™ ë³´ì •)

---

## ğŸ—‚ï¸ Parent-Child ê³„ì¸µ êµ¬ì¡°

### êµ¬ì¡° ì˜ˆì‹œ

```
ğŸ“ 5 ì ˆì°¨ Procedure                     (parent: null, page: 4)
  â”œâ”€â”€ ğŸ“ 5.1 í’ˆì§ˆê´€ë¦¬ê¸°ì¤€ì„œì˜ êµ¬ì„±       (parent: "5 ì ˆì°¨ Procedure", page: 4)
  â”‚     â”œâ”€â”€ ğŸ“ 5.1.1 í•„ìˆ˜ êµ¬ì„± ìš”ì†Œ      (parent: "5.1 í’ˆì§ˆê´€ë¦¬ê¸°ì¤€ì„œì˜ êµ¬ì„±", page: 4)
  â”‚     â””â”€â”€ ğŸ“ 5.1.2 êµ¬ì„± ë° ë‚´ìš©        (parent: "5.1 í’ˆì§ˆê´€ë¦¬ê¸°ì¤€ì„œì˜ êµ¬ì„±", page: 5)
  â”‚           â””â”€â”€ ğŸ“ 5.1.2.1 í’ˆì§ˆê´€ë¦¬ê¸°ì¤€ì„œëŠ”... (parent: "5.1.2 êµ¬ì„± ë° ë‚´ìš©", page: 5)
  â”œâ”€â”€ ğŸ“ 5.2 ì‹œí—˜ë°©ë²•ì„œ/ê·œê²©ì„œ ì—°ê³„      (parent: "5 ì ˆì°¨ Procedure", page: 5)
  â””â”€â”€ ğŸ“ 5.3 ì‹œí—˜ ìˆ˜í–‰ ë° ê²°ê³¼ íŒì •      (parent: "5 ì ˆì°¨ Procedure", page: 6)
```

### í™œìš© ë°©ë²•

```python
# ìƒìœ„ ì„¹ì…˜ ì»¨í…ìŠ¤íŠ¸ ì¶”ê°€
if chunk['metadata']['parent']:
    context += f"\n[ìƒìœ„ ì„¹ì…˜: {chunk['metadata']['parent']}]"

# ê°™ì€ ë¶€ëª¨ë¥¼ ê°€ì§„ í˜•ì œ ì„¹ì…˜ ì°¾ê¸°
siblings = [c for c in chunks if c['metadata']['parent'] == target_parent]
```

---

## ğŸ“„ í˜ì´ì§€ ë²ˆí˜¸ ì¶”ì 

### PDF ë³€í™˜ ì‹œ í˜ì´ì§€ ë§ˆì»¤ ì‚½ì…

```python
def _convert_pdf_with_fallback(filename, content):
    with pdfplumber.open(BytesIO(content)) as pdf:
        md_lines = []
        for i, page in enumerate(pdf.pages):
            text = page.extract_text() or ''
            if text.strip():
                md_lines.append(f"<!-- PAGE:{i + 1} -->")  # ğŸ”¥ ë§ˆì»¤ ì‚½ì…
                md_lines.append(text)
    return '\n'.join(md_lines), metadata, "pdfplumber"
```

### Split ë‹¨ê³„ì—ì„œ í˜ì´ì§€ ì¶”ì 

```python
def node_split(state):
    current_page = 1
    
    for line in lines:
        # í˜ì´ì§€ ë§ˆì»¤ ê°ì§€
        page_match = re.match(r'<!-- PAGE:(\d+) -->', line)
        if page_match:
            current_page = int(page_match.group(1))
            continue
        
        # ì„¹ì…˜ì— í˜ì´ì§€ ì •ë³´ ì €ì¥
        sections.append({
            "content": content,
            "page": current_page,  # ğŸ”¥
            ...
        })
```

---

## ğŸ”§ API ì‘ë‹µ ì˜ˆì‹œ

### POST /rag/upload ì‘ë‹µ

```json
{
    "success": true,
    "filename": "EQ-SOP-00010_í’ˆì§ˆê´€ë¦¬ê¸°ì¤€ì„œ.pdf",
    "sop_id": "EQ-SOP-00010",
    "chunks": 70,
    "pipeline_version": "v9.1-langgraph",
    "quality_score": 0.8,
    "conversion_method": "pdfplumber+infer-headers",
    "warnings": [],
    "metadata": {
        "version": "1.0",
        "effective_date": "2025-01-21",
        "title": "í’ˆì§ˆê´€ë¦¬ê¸°ì¤€ì„œ",
        "department": "í’ˆì§ˆê²½ì˜ì‹¤",
        "total_pages": 11
    }
}
```

### POST /rag/search ì‘ë‹µ

```json
{
    "query": "í’ˆì§ˆê´€ë¦¬ì±…ì„ìì˜ ì±…ì„ì€?",
    "results": [
        {
            "text": "í’ˆì§ˆê´€ë¦¬ì±…ì„ì(QC Manager)ëŠ” ë³¸ ê¸°ì¤€ì„œì˜ ì œÂ·ê°œì •...",
            "similarity": 0.87,
            "metadata": {
                "doc_name": "EQ-SOP-00010_í’ˆì§ˆê´€ë¦¬ê¸°ì¤€ì„œ.pdf",
                "sop_id": "EQ-SOP-00010",
                "section_path": "4 ì±…ì„ Responsibilities",
                "section": "4.1 í’ˆì§ˆê´€ë¦¬ì±…ì„ì(QC Manager)ëŠ”...",
                "article_num": "4.1",
                "page": 3,
                "parent": "4 ì±…ì„ Responsibilities"
            },
            "confidence": "high"
        }
    ],
    "count": 5
}
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### ëª©ì°¨ vs ë³¸ë¬¸ ì¤‘ë³µ

PDF ë¬¸ì„œì—ì„œ **ëª©ì°¨(page 1)**ì™€ **ë³¸ë¬¸(page 4~)**ì´ ê°™ì€ ì„¹ì…˜ ë²ˆí˜¸ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŒ.

**í•´ê²°:** 
- ëª©ì°¨ ê°ì§€ ë¡œì§ìœ¼ë¡œ ìŠ¤í‚µ
- `page` í•„ë“œë¡œ êµ¬ë¶„ ê°€ëŠ¥

### íŒŒì¼ëª… í™•ì¥ì ê°ì§€

```python
# âœ… v9.1 (ì‹¤ì œ í™•ì¥ì ê¸°ì¤€)
"report_docx.pdf" â†’ PDFë¡œ ì²˜ë¦¬

# âŒ v9.0 ì´ì „ (ë¬¸ìì—´ í¬í•¨ ê¸°ì¤€)
"report_docx.pdf" â†’ DOCXë¡œ ì˜ëª» ì²˜ë¦¬
```

### í—¤ë” ì¶”ë¡  í•œê³„

PDFëŠ” ìŠ¤íƒ€ì¼ ì •ë³´ê°€ ì—†ìœ¼ë¯€ë¡œ **íŒ¨í„´ ê¸°ë°˜ ì¶”ë¡ **:
- "1 ëª©ì  Purpose" â†’ `## 1 ëª©ì  Purpose`
- "5.1.1 xxx" â†’ `#### 5.1.1 xxx`

100% ì •í™•í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ (ë³µì¡í•œ ë ˆì´ì•„ì›ƒ, ë¹„ì •í˜• ë¬¸ì„œ)

---

## ğŸ“ˆ ë²„ì „ íˆìŠ¤í† ë¦¬

| ë²„ì „ | ë³€ê²½ ì‚¬í•­ |
|------|----------|
| **v9.1** | í˜ì´ì§€ ë²ˆí˜¸, Parent-Child ê³„ì¸µ, ë¬¸ì„œ ë©”íƒ€ë°ì´í„° ì¶”ì¶œ, ë©”íƒ€ë°ì´í„° ìµœì í™” |
| v9.0 | LangGraph ìƒíƒœ ë¨¸ì‹ , ì¡°ê±´ë¶€ ë¶„ê¸°, í’ˆì§ˆ ê²€ì¦ |
| v8.1 | ì»¨í…ìŠ¤íŠ¸ í”„ë¦¬í”½ìŠ¤, í…Œì´ë¸” ë³´ì¡´ |
| v8.0 | ë§ˆí¬ë‹¤ìš´ íŒŒì´í”„ë¼ì¸ |
| v7.0 | ì†Œì œëª© íŒ¨í„´, í™•ì¥ì ë²„ê·¸ ìˆ˜ì • |
| v6.3 | section_path ê³„ì¸µ ì¶”ì  |